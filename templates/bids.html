{% extends "base.html" %}

{% block title %}{{ job.title }} - Bids - FreelanceHub{% endblock %}

{% block content %}
<div class="space-y-6">
    <div>
        <h1 class="text-3xl font-bold mb-2">Bids for: {% if job is defined and job %}{{ job.title }}{% else %}Job{% endif %}</h1>
        {% if job is defined and job %}
        <a href="{{ url_for('job_detail', job_id=job.id) }}" class="text-blue-600 hover:underline">
            <i class="fas fa-arrow-left"></i> Back to Job
        </a>
        {% endif %}
    </div>

    {% if bids %}
        <div class="space-y-4">
            {% for bid in bids %}
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition">
                    <div class="grid md:grid-cols-5 gap-4 items-start mb-4">
                        <div class="flex items-center gap-4">
                            <!-- Profile Image -->
                            {% if bid.freelancer and bid.freelancer.freelancer_profile and bid.freelancer.freelancer_profile.profile_image %}
                                <img src="{{ url_for('uploaded_file', filename=bid.freelancer.freelancer_profile.profile_image) }}" 
                                     onerror="this.src='https://via.placeholder.com/60'" 
                                     class="w-16 h-16 rounded-full object-cover border-2 border-blue-200">
                            {% else %}
                                <div class="w-16 h-16 rounded-full bg-gradient-to-br from-blue-100 to-blue-200 flex items-center justify-center border-2 border-blue-200">
                                    <i class="fas fa-user text-2xl text-blue-500"></i>
                                </div>
                            {% endif %}
                            
                            <!-- Info -->
                            <div>
                                <h3 class="text-lg font-bold text-gray-800">{{ bid.freelancer.name if bid.freelancer else 'Freelancer' }}</h3>
                                {% if bid.freelancer and bid.freelancer.freelancer_profile %}
                                    <p class="text-sm text-gray-600">
                                        <span class="text-yellow-500">
                                            {% for i in range(bid.freelancer.freelancer_profile.avg_rating|int) %}⭐{% endfor %}
                                        </span>
                                        {{ "%.1f"|format(bid.freelancer.freelancer_profile.avg_rating) }} 
                                        ({{ bid.freelancer.freelancer_profile.total_reviews }} reviews)
                                    </p>
                                    <a href="{{ url_for('view_freelancer_profile', user_id=bid.freelancer.id) }}" class="text-blue-600 hover:text-blue-700 text-sm font-semibold">
                                        View Profile →
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-600 text-sm">Bid Amount</p>
                            <p class="text-2xl font-bold text-green-600">₹{{ "%.2f"|format(bid.amount) }}</p>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-600 text-sm">Delivery Time</p>
                            <p class="text-lg font-semibold">{{ bid.delivery_days }} days</p>
                        </div>
                        <div class="text-center">
                            <p class="text-gray-600 text-sm">Status</p>
                            <p class="text-lg font-semibold
                                {% if bid.status == 'accepted' %}text-green-600
                                {% elif bid.status == 'rejected' %}text-red-600
                                {% else %}text-yellow-600{% endif %}">
                                {{ bid.status|capitalize }}
                            </p>
                        </div>
                        <div class="text-right">
                            {% if job and job.status == 'open' and bid.status == 'pending' and not job.accepted_bid_id %}
                                <form method="POST" action="{{ url_for('accept_bid', bid_id=bid.id) }}" style="display:inline">
                                    <button type="submit" class="bg-green-600 text-white px-6 py-2 rounded font-semibold hover:bg-green-700 w-full">
                                        <i class="fas fa-check"></i> Accept
                                    </button>
                                </form>
                            {% endif %}
                        </div>
                    </div>

                    <div class="border-t pt-4">
                        <p class="text-gray-600 text-sm mb-2"><strong>Proposal:</strong></p>
                        <p class="text-gray-700">{{ bid.proposal }}</p>
                    </div>

                    {% if bid.freelancer.freelancer_profile and bid.freelancer.freelancer_profile.portfolio_link %}
                        <div class="mt-3 pt-3 border-t">
                            <a href="{{ bid.freelancer.freelancer_profile.portfolio_link }}" target="_blank" class="text-blue-600 hover:underline text-sm">
                                <i class="fas fa-external-link-alt"></i> View Portfolio
                            </a>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-white p-12 rounded-lg shadow-md text-center">
            <p class="text-gray-600 text-lg">No bids received yet. Share your job to attract more bidders.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
